# name: Backend CI/CD - AWS EC2 Deploy

# on:
#   push:
#     branches: [ main ]

# jobs:
#   deploy:
#     runs-on: ubuntu-latest

#     steps:
#       - name: Checkout code
#         uses: actions/checkout@v4

#       - name: Setup Node.js
#         uses: actions/setup-node@v4
#         with:
#           node-version: '18'

#       - name: Install dependencies & test build
#         run: |
#           npm ci
#           npm run build --if-present

#       - name: Deploy to EC2 via SSH
#         uses: appleboy/ssh-action@v1.2.0
#         with:
#           host: ${{ secrets.AWS_SSH_HOST }}
#           username: ${{ secrets.AWS_SSH_USERNAME }}
#           key: ${{ secrets.AWS_SSH_KEY }}
#           script: |
#             cd /home/ec2-user/todo-backend
#             git pull origin main
#             npm ci --production
#             pm2 reload todo-backend || pm2 start app.js --name todo-backend --update-env
#             pm2 save
